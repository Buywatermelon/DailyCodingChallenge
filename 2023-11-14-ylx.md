# JVM内存区域和功能介绍

首先参考《深入JVM虚拟机》中的2.2章节 运行时数据区域的配图
![1699944355561.png](https://img1.imgtp.com/2023/11/14/CoOzhrng.png)

运行时数据区分为：
- 程序计数器
- 虚拟机栈
- 本地方法栈
- 方法区
- 堆
- 直接内存

## 程序计数器
线程私有，一小块内存空间，用来存储当前线程执行的字节码指令的地址。

## 虚拟机栈
线程私有，当方法执行/退出时，会有栈帧入栈/出栈。

栈帧中存储局部变量表、操作数栈、动态链接信息以及方法出口等信息。

## 本地方法栈
与虚拟机栈类似，区别在于，虚拟机栈用于执行Java方法。

本地方法栈用于执行本地方法。

## 方法区
线程共享，用于存储已被虚拟机加载的类型信息、常量、静态变量、即时编译器编译后的代码缓存等数据。

在JDK8以前的HotSpot虚拟机实现中，使用永久代存储，是属于堆的一部分。

在JDK以后的HotSpot虚拟机实现中，采用元空间替代了永久代，元空间直接在本地内存中进行数据存储。

## 堆
线程共享，JVM中最大的内存区域，用于存储Java对象和数组。

垃圾收集器主要在此区域工作。

## 直接内存
直接内存并不是虚拟机运行时数据区的一部分。

在JDK1.4中加入的NIO类，引入了一种基于通道与缓冲区的I/O方式，它可以使用Native库函数直接分配堆外内存，
然后通过一个存储在Java堆中的DirectByteBuffer对象作为这块内存的引用进行操作。

这在一些场景中可以显著提高性能，因为避免了在Java堆和Native堆中来回复制数据。
